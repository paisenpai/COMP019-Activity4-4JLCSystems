@model COMP019_Activity4_4JLCSystems.Models.ViewModels.OrderDetailsViewModel
@{
    ViewData["Title"] = "Order Details";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2"><i class="bi bi-receipt me-2"></i>Order Details</h1>
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Back to Orders
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <!-- Order Items -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Order Items</h5>
                <span class="badge fs-6 @(Model.Order.OrderStatus == "Pending" ? "bg-warning text-dark" : Model.Order.OrderStatus == "Paid" ? "bg-info" : Model.Order.OrderStatus == "Shipped" ? "bg-primary" : Model.Order.OrderStatus == "Delivered" ? "bg-success" : "bg-secondary")">
                    @Model.Order.OrderStatus
                </span>
            </div>
            <div class="table-responsive">
                <table class="table mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Product</th>
                            <th class="text-center">Quantity</th>
                            <th class="text-end">Unit Price</th>
                            <th class="text-end">Unit Cost</th>
                            <th class="text-end">Line Total</th>
                            <th class="text-end">Line Profit</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderItems)
                        {
                            <tr>
                                <td>
                                    <strong>@item.ProductName</strong>
                                </td>
                                <td class="text-center">@item.Quantity</td>
                                <td class="text-end">&#8369;@item.UnitPrice.ToString("N2")</td>
                                <td class="text-end text-muted">&#8369;@item.UnitCost.ToString("N2")</td>
                                <td class="text-end">&#8369;@item.LineTotal.ToString("N2")</td>
                                <td class="text-end text-success">&#8369;@item.LineProfit.ToString("N2")</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot class="table-light">
                        <tr>
                            <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                            <td class="text-end"><strong>&#8369;@Model.Order.Subtotal.ToString("N2")</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-end">Shipping Fee:</td>
                            <td class="text-end text-danger">- &#8369;@Model.Order.ShippingFee.ToString("N2")</td>
                            <td></td>
                        </tr>
                        <tr class="table-primary">
                            <td colspan="4" class="text-end"><strong>Total Amount:</strong></td>
                            <td class="text-end"><strong class="fs-5">&#8369;@Model.Order.TotalAmount.ToString("N2")</strong></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        
        <!-- Profit Calculation -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-calculator me-2"></i>Profit Calculation</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm mb-0">
                    <tr>
                        <td>Sales Revenue (Subtotal):</td>
                        <td class="text-end text-success">+ &#8369;@Model.Order.Subtotal.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td>Total Item Costs (Puhunan):</td>
                        <td class="text-end text-danger">- &#8369;@Model.TotalCost.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td>Shipping Fee:</td>
                        <td class="text-end text-danger">- &#8369;@Model.Order.ShippingFee.ToString("N2")</td>
                    </tr>
                    <tr class="table-success">
                        <td><strong>Net Profit:</strong></td>
                        <td class="text-end"><strong class="@(Model.Profit >= 0 ? "text-success" : "text-danger") fs-5">&#8369;@Model.Profit.ToString("N2")</strong></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Order Info -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Order Information</h6>
            </div>
            <div class="card-body">
                <table class="table table-sm mb-0">
                    <tr>
                        <td class="text-muted">Order #:</td>
                        <td class="text-end"><code>@Model.Order.OrderNumber</code></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Order Date:</td>
                        <td class="text-end">@Model.Order.OrderDate.ToString("MMM dd, yyyy h:mm tt")</td>
                    </tr>
                    @if (Model.Order.PaymentDate.HasValue)
                    {
                        <tr>
                            <td class="text-muted">Payment Date:</td>
                            <td class="text-end">@Model.Order.PaymentDate.Value.ToString("MMM dd, yyyy h:mm tt")</td>
                        </tr>
                        <tr>
                            <td class="text-muted">Payment Method:</td>
                            <td class="text-end">@(Model.Order.PaymentMethod ?? "N/A")</td>
                        </tr>
                    }
                </table>
            </div>
        </div>
        
        <!-- Customer Info -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-person me-2"></i>Customer Information</h6>
            </div>
            <div class="card-body">
                <p class="mb-2"><strong>@(Model.Order.CustomerName ?? "N/A")</strong></p>
                <p class="mb-2 small text-muted">
                    <i class="bi bi-geo-alt me-1"></i>@(Model.Order.ShippingAddress ?? "No address provided")
                </p>
                @if (!string.IsNullOrEmpty(Model.Order.ContactNumber))
                {
                    <p class="mb-0 small text-muted">
                        <i class="bi bi-telephone me-1"></i>@Model.Order.ContactNumber
                    </p>
                }
            </div>
        </div>
        
        <!-- Actions -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h6 class="mb-0"><i class="bi bi-lightning me-2"></i>Actions</h6>
            </div>
            <div class="card-body">
                @if (Model.Order.OrderStatus == "Pending")
                {
                    <a asp-action="ProcessPayment" asp-route-id="@Model.Order.OrderId" class="btn btn-success w-100 mb-2">
                        <i class="bi bi-credit-card me-1"></i>Process Payment
                    </a>
                    <form asp-action="UpdateStatus" method="post" class="mb-2">
                        <input type="hidden" name="id" value="@Model.Order.OrderId" />
                        <input type="hidden" name="status" value="Cancelled" />
                        <button type="submit" class="btn btn-outline-danger w-100" onclick="return confirm('Cancel this order? Inventory will be restored.')">
                            <i class="bi bi-x-lg me-1"></i>Cancel Order
                        </button>
                    </form>
                }
                else if (Model.Order.OrderStatus == "Paid")
                {
                    <form asp-action="UpdateStatus" method="post" class="mb-2">
                        <input type="hidden" name="id" value="@Model.Order.OrderId" />
                        <input type="hidden" name="status" value="Shipped" />
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-truck me-1"></i>Mark as Shipped
                        </button>
                    </form>
                }
                else if (Model.Order.OrderStatus == "Shipped")
                {
                    <form asp-action="UpdateStatus" method="post" class="mb-2">
                        <input type="hidden" name="id" value="@Model.Order.OrderId" />
                        <input type="hidden" name="status" value="Delivered" />
                        <button type="submit" class="btn btn-success w-100">
                            <i class="bi bi-check-circle me-1"></i>Mark as Delivered
                        </button>
                    </form>
                }
                
                @if (Model.Order.OrderStatus == "Pending" || Model.Order.OrderStatus == "Cancelled")
                {
                    <a asp-action="Delete" asp-route-id="@Model.Order.OrderId" class="btn btn-outline-danger w-100">
                        <i class="bi bi-trash me-1"></i>Delete Order
                    </a>
                }
            </div>
        </div>
    </div>
</div>
